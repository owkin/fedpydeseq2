| ID | Name | Type | Shape | Description | Computed by | Sent to |
|---|---|---|---|---|---|---|
| 1 | use\_lvl | bool | $()$ | Whether or not to use the levels of the design matrix to compute the trimmed mean. If use\_lvl is $\texttt{True}$, then one trimmed mean of the normed counts will be computed for each gene and for each level of the design matrix (that is the trimmed mean will be performed on the samples corresponding to the same level of the design matrix across all centers). If use\_lvl is $\texttt{False}$, then one trimmed mean of the normed counts will be computed for each gene and for all samples. This parameter is set to $\texttt{True}$ if there is at least one level of the design matrix with more than 3 replicates across all centers, and to $\texttt{False}$ otherwise. | Each center | Server |
| 1 | $l \in \mathcal{L}_{\geq 3}$ | dict |  | Let $\mathcal{L}_{\geq 3}$ bet the set of levels $1 \leq l \leq L$ of the design matrix with at least $3$ replicates across all centers. Let $\mathcal{I}_{k,l}$ denote the set of sample indices $1 \leq i \leq n_k$ in center $k$ whose line in the design corresponds to level $l$. Dictionary with two keys. <br> "max\_values", which is a numpy array of shape $G$ containing, for each gene $g$, the maximum value of the center normed counts for $g$ on samples in $\mathcal{I}_{k,l}$, denoted with $(Z^{\texttt{max}}_{g,l})^{(k)}$. <br> "min\_values", which is a numpy array of shape $G$ containing, for each gene $g$, the minimum value of the center normed counts for $g$ on samples in $\mathcal{I}_{k,l}$, denoted with $(Z^{\texttt{min}}_{g,l})^{(k)}$. | Each center | Server |
| 2 | use\_lvl | bool | $()$ | Whether or not to use the levels of the design matrix to compute the trimmed mean. Passed on without modification. | Server | Center |
| 2 | $l \in \mathcal{L}_{\geq 3}$ | dict |  | Dictionary with two keys. <br> "upper\_bounds\_thresholds" is a numpy array of shape $(G, 2)$. For each gene $g$ and for each ratio $r \in \{r_{\texttt{trim}}, 1 - r_{\texttt{trim}}\}$, will contain an upper bound of the $r$-quantile value of the normed counts of gene $g$ across samples in level $l$. Initialized for both ratios as the maximum of the normed counts of gene $g$ across all samples in level $l$, computed as $\max_k (Z^{\texttt{max}}_{g,l})^{(k)}$. <br> "lower\_bounds\_thresholds" is a numpy array of shape $(G, 2)$. For each gene $g$ and for each ratio $r \in \{r_{\texttt{trim}}, 1 - r_{\texttt{trim}}\}$, will contain a lower bound of the $r$-quantile value of the normed counts of gene $g$ across samples in level $l$. Initialized for both ratios as the minimum of the normed counts of gene $g$ across all samples in level $l$, computed as $\min_k (Z^{\texttt{min}}_{g,l})^{(k)}$. | Server | Center |
| 3 | use\_lvl | bool | $()$ | Whether or not to use the levels of the design matrix to compute the trimmed mean. Passed on without modification. | Each center | Server |
| 3 | $l \in \mathcal{L}_{\geq 3}$ | dict |  | Dictionary with the following keys. <br> "num\_strictly\_above" is a numpy array of shape $(G, 2)$. For each gene $g$ and each ratio $r$, contains the number of samples in the center and in the level whose normed counts value for gene $g$ is strictly above the average of the upper and lower  bounds on the $r$-quantile value of gene $g$. <br> "upper\_bounds\_thresholds" is a numpy array of shape $(G, 2)$, simply passed on from the previous state. <br> "lower\_bounds\_thresholds" is a numpy array of shape $(G, 2)$ simply passed on from the previous state. <br> "n\_samples" is the number of samples in level $l$ and center $k$. <br> "trim\_ratio" is the trim ration, defining the upper and lower ratios whose quantile we want to compute. Denoted with $r_{\texttt{trim}}$, equal to $0.125$. | Each center | Server |
| 4 | use\_lvl | bool | $()$ | Whether or not to use the levels of the design matrix to compute the trimmed mean. Passed on without modification. | Server | Center |
| 4 | $l \in \mathcal{L}_{\geq 3}$ | dict |  | Dictionary with two keys. <br> "upper\_bounds\_thresholds" is a numpy array of shape $(G, 2)$. For each gene $g$ and for each ratio $r \in \{r_{\texttt{trim}}, 1 - r_{\texttt{trim}}\}$, contains an updated upper bound of the $r$-quantile value of the normed counts of gene $g$ across samples in level $l$. For a given gene $g$ and $r$-quantile, it is updated as either its previous value or the average of the previous upper and lower bounds across samples in level $l$, depending on the number of samples in the level whose normed counts value is strictly above this average. This number of samples can be computed from the previous shared states. <br> "lower\_bounds\_thresholds" is a numpy array of shape $(G, 2)$. For each gene $g$ and for each ratio $r \in \{r_{\texttt{trim}}, 1 - r_{\texttt{trim}}\}$, contains an updated lower bound of the $r$-quantile value of the normed counts of gene $g$ across samples in level $l$. For a given gene $g$ and $r$-quantile, it is updated as either its previous value or the average of the previous upper and lower bounds across samples in level $l$, depending on the number of samples in the level whose normed counts value is strictly above this average. This number of samples can be computed from the previous shared states. | Server | Center |
| 5 | use\_lvl | bool | $()$ | Whether or not to use the levels of the design matrix to compute the trimmed mean. Passed on without modification. | Each center | Server |
| 5 | $l \in \mathcal{L}_{\geq 3}$ | dict |  | Dictionary with the following keys. <br> "trimmed\_local\_sum" is a numpy array of shape $(G,)$. For each gene $g$ and each ration $r \in \{r_{\texttt{trim}}, 1 - r_{\texttt{trim}}\}$, we approximate the $r$-quantile by taking the average of the running upper and lower bounds. The trimmed local sum is computed as the sum of the normed counts across all samples in level $l$ and center $k$, whose value is strictly above the approximation of the $r_{\texttt{trim}}$-quantile and less or equal to the approximation of the $1-r_{\texttt{trim}}$ quantile. <br> "n\_samples" is the number of samples in level $l$ and center $k$. <br> "num\_strictly\_above" is a numpy array of shape $(G, 2)$. For each gene $g$ and each ratio $r$, contains the number of samples in the center and in the level whose normed counts value for gene $g$ is strictly above the approximation of the $r$-quantile. <br> "upper\_bounds\_thresholds" is a numpy array of shape $(G, 2)$, simply passed on from the previous state. <br> "lower\_bounds\_thresholds" is a numpy array of shape $(G, 2)$ simply passed on from the previous state. "trim\_ratio", equal to $0.125$. | Each center | Server |
| 6 | trimmed\_mean\_normed\_counts | DataFrame | $(G, \|\mathcal{L}_{\geq 3}\|)$ | For each gene $g$ and each level $l \in \mathcal{L}_{\geq 3}$, the corresponding entry $\overline{Z}^{\texttt{trim}}_{g,l}$ is the approximation of the trimmed mean of the normed counts for gene $g$ and samples whose line in the design corresponds to level $l$ with trim ratio $r_{\texttt{trim}}$, computed by summing the trimmed\_local\_sums and dividing by the sum of the local n\_samples for the corresponding gene and level. | Server | Center |
