| ID | Name | Type | Shape | Description | Computed by | Sent to |
|---|---|---|---|---|---|---|
| 0 | cooks\_dispersions | nparray | $(G,)$ | For each gene $g$, a robust estimate of the dispersion parameter $\alpha^{\texttt{cooks}}_g$ computed from the trimmed variance estimate and the global mean of the normed counts. We compute this estimate as $\max((V^{\texttt{trim}}_g- \overline{Y}_g)/\overline{Y}_g^2,0.04)$. | Server | Center |
| 0 | global\_hat\_matrix\_inv | nparray | $(G_{\texttt{nz}}, p, p)$ | For each gene $g$, we compute the global hat matrix as the sum of the local hat matrices, and its inverse. | Server | Center |
| 1 | local\_genes\_to\_replace | set |  | The set of genes $g$ for which the Cook's distance is above the cutoff value for any sample in the center. For a given gene $g$ and given sample $i$, the Cook's distance is computed as $\tfrac{h^{(k)}_{ig}}{p (1-h^{(k)}_{ig})^2}~(R^2)^{(k)}_{ig}$ where $(R^2)^{(k)}_{ig}$ is the squared Pearson residual of the negative binomial GLM with log fold changes $\beta_g$ and dispersions $\alpha^{\texttt{cooks}}_g$, computed as $(Y^{(k)}_{ig} - \mu^{(k)}_{ig})^2/(V^{\texttt{NB}})^{(k)}_{ig}$, and $h^{(k)}_{ig}$ is the $i$-th diagonal element of $X^{(k)} H^{-1}_{g} (X^{(k)})^{\top}$, where $H^{-1}_{g}$ is the inverse of the global hat matrix. The cutoff value is set to the $0.99$-th quantile of the F-distribution with $p$ and $n-p$ degrees of freedom. Here, $\mu^{(k)}_{ig} = \gamma^{(k)}_{i}~\exp(X^{(k)}_{i} \cdot \beta_g)$ and $(V^{\texttt{NB}})^{(k)}_{ig} = \mu^{(k)}_{ig} (1 + \mu^{(k)}_{ig} \alpha^{\texttt{cooks}}_g)$. | Each center | Server |
| 1 | replaceable\_samples | bool | $()$ | A boolean indicating if there are any replaceable samples in the center. A sample $i$ of center $k$ is said to be replaceable if there are at least $\texttt{min\_replicates}$ samples across all centers which share the same design factor levels as $i$. $\texttt{min\_replicates}$ is a user defined parameter, set to $7$ by default. | Each center | Server |
| 2 | genes\_to\_replace | set |  | The set of genes $g$ for which the Cook's distance is above the cutoff value for any sample in any center (the union of the local genes to replace across all centers). | Server | Center |
| 4 | use\_lvl | bool |  | Whether or not to use the levels of the design matrix to compute the trimmed mean. Set to $\texttt{False}$ in this case, so that the trimmed mean is computed across all samples. | Each center | Server |
| 4 | max\_values | nparray | $(G_{\texttt{r}},)$ | Contains the maximum value of the center normed counts for each gene to replace $g$ across all samples. | Each center | Server |
| 4 | min\_values | nparray | $(G_{\texttt{r}},)$ | Contains the minimum value of the center normed counts for each gene to replace $g$  across all samples. | Each center | Server |
| 5 | use\_lvl | bool |  | Set to $\texttt{False}$ in this case, simply passed on from the previous state. | Server | Center |
| 5 | upper\_bounds\_thresholds | nparray | $(G_{\texttt{r}}, p)$ | Contains an upper bound of the $r_{\texttt{trim}}$-quantile value of the normed counts for each gene to replace $g$ across all samples. for each gene to replace $g$, the first entry is the upper bound of the $r_{\texttt{trim}}$-quantile value, and the second entry is the upper bound of the $1-r_{\texttt{trim}}$-quantile value, where $r_{\texttt{trim}}=0.2$. | Server | Center |
| 5 | lower\_bounds\_thresholds | nparray | $(G_{\texttt{r}}, p)$ | Contains a lower bound of the $r_{\texttt{trim}}$-quantile value of the normed counts for each gene to replace $g$ across all samples. for each gene to replace $g$, the first entry is the lower bound of the $r_{\texttt{trim}}$-quantile value, and the second entry is the lower bound of the $1-r_{\texttt{trim}}$-quantile value, where $r_{\texttt{trim}}=0.2$. | Server | Center |
| 6 | trim\_ratio | float |  | The trim ratio, defining the upper and lower ratios whose quantile we want to compute. Denoted with $r_{\texttt{trim}}$, equal to $0.2$. | Each center | Server |
| 6 | lower\_bounds\_thresholds | nparray | $(G_{\texttt{r}}, p)$ | Simply passed on from the previous state. | Each center | Server |
| 6 | n\_samples | int |  | The number of samples in a center $n_k$ for each center $k$. | Each center | Server |
| 6 | num\_strictly\_above | nparray | $(G_{\texttt{r}}, p)$ | Contains the number of samples whose normed counts value for each gene to replace $g$ is strictly above the average of the upper and lower bounds on the $r_{\texttt{trim}}$-quantile value of gene $g$ across all samples. for each gene to replace $g$, the first entry is the number of samples whose normed counts value is strictly above the average of the upper and lower bounds on the $r_{\texttt{trim}}$-quantile value, and the second entry is the number of samples whose normed counts value is strictly above the average of the upper and lower bounds on the $1-r_{\texttt{trim}}$-quantile value, where $r_{\texttt{trim}}=0.2$. | Each center | Server |
| 6 | use\_lvl | bool |  | Set to $\texttt{False}$ in this case, simply passed on from the previous state. | Each center | Server |
| 6 | upper\_bounds\_thresholds | nparray | $(G_{\texttt{r}}, p)$ | Simply passed on from the previous state. | Each center | Server |
| 7 | use\_lvl | bool |  | Set to $\texttt{False}$ in this case, simply passed on from the previous state. | Server | Center |
| 7 | upper\_bounds\_thresholds | nparray | $(G_{\texttt{r}}, p)$ | for each gene to replace $g$ and for each ratio $r \in \{r_{\texttt{trim}}, 1 - r_{\texttt{trim}}\}$, contains an updated upper bound of the $r$-quantile value of the normed counts of gene $g$ across all samples. For a given gene $g$ and $r$-quantile, it is updated as either its previous value or the average of the previous upper and lower bounds across all samples, depending on the number of samples whose normed counts value is strictly above this average. This number of samples can be computed from the previous shared states. | Server | Center |
| 7 | lower\_bounds\_thresholds | nparray | $(G_{\texttt{r}}, p)$ | for each gene to replace $g$ and for each ratio $r \in \{r_{\texttt{trim}}, 1 - r_{\texttt{trim}}\}$, contains an updated lower bound of the $r$-quantile value of the normed counts of gene $g$ across all samples. For a given gene $g$ and $r$-quantile, it is updated as either its previous value or the average of the previous upper and lower bounds across all samples, depending on the number of samples whose normed counts value is strictly above this average. This number of samples can be computed from the previous shared states. | Server | Center |
| 8 | trim\_ratio | float |  | the trim ratio, set to $0.2$ | Each center | Server |
| 8 | lower\_bounds\_thresholds | nparray | $(G_{\texttt{r}}, p)$ | Simply passed on from the previous state. | Each center | Server |
| 8 | upper\_bounds\_thresholds | nparray | $(G_{\texttt{r}}, p)$ | Simply passed on from the previous state. | Each center | Server |
| 8 | n\_samples | int |  | The number of samples in a center $n_k$ for each center $k$. | Each center | Server |
| 8 | trimmed\_local\_sum | nparray | $(G_{\texttt{r}},)$ | A numpy array of shape $(G,)$ containing the sum of the normed counts across all samples, whose value is strictly above the approximation of the $r_{\texttt{trim}}$-quantile and less or equal to the approximation of the $1-r_{\texttt{trim}}$ quantile. For each gene to replace $g$, the entry is the trimmed local sum. | Each center | Server |
| 8 | use\_lvl | bool |  | Set to $\texttt{False}$ in this case, simply passed on from the previous state. | Each center | Server |
| 8 | num\_strictly\_above | nparray | $(G_{\texttt{r}}, p)$ | Contains the number of samples whose normed counts value for each gene to replace $g$ is strictly above the average of the upper and lower bounds on the $r_{\texttt{trim}}$-quantile value of gene $g$ across all samples. for each gene to replace $g$, the first entry is the number of samples whose normed counts value is strictly above the average of the upper and lower bounds on the $r_{\texttt{trim}}$-quantile value, and the second entry is the number of samples whose normed counts value is strictly above the average of the upper and lower bounds on the $1-r_{\texttt{trim}}$-quantile value, where $r_{\texttt{trim}}=0.2$. | Each center | Server |
| 9 | trimmed\_mean\_normed\_counts | nparray | $(G_{\texttt{r}},)$ | For each gene to replace $g$, the trimmed mean of the normed counts across all samples, denoted with $\overline{Z}^{\texttt{trim}}_{g}$, with trim ratio set to $0.2$. | Server | Center |
| 10 | loc\_new\_all\_zeroes | nparray | $(G_{\texttt{r}},)$ | A boolean array which for each gene to replace $g$ indicates if the new count matrix of the center is all zeroes (across samples) for this gene (the new count matrix is computed by imputing the Cook's outliers with the trimmed mean of the normed counts times the size factor). | Each center | Server |
| 11 | new\_all\_zeroes | nparray | $(G_{\texttt{r}},)$ | A boolean array which for each gene to replace $g$ indicates if all counts across all centers are zero for this gene. | Server | Center |
| 12 | local\_features | nparray | $(p, G_{\texttt{act}})$ | $\Phi^{(k)}  := (X^{(k)})^{\top} Z^{(k)}$, where $Z^{(k)}$ is the normalized counts in the center $k$ on the set of genes to replace, where the value of Cook's outliers have been replaced using a trimmed mean. | Each center | Server |
